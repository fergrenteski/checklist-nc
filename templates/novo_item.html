{% extends "base.html" %}

{% block title %}Novo Item - {{ checklist.nome }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">
                    <i class="bi bi-plus-circle"></i> Adicionar Novo Item
                </h3>
                <small>Checklist: {{ checklist.nome }}</small>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('checklist.novo_item', checklist_id=checklist.id) }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="secao" class="form-label">Seção *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="secao" 
                                   name="secao" 
                                   required
                                   placeholder="Ex: Documentação, Processos, Equipamentos">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="resultado" class="form-label">Resultado *</label>
                            <select class="form-select" id="resultado" name="resultado" required>
                                <option value="">Selecione...</option>
                                <option value="Conforme">Conforme</option>
                                <option value="Não Conforme">Não Conforme</option>
                                <option value="N/A">N/A (Não Aplicável)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="item_verificacao" class="form-label">Item de Verificação *</label>
                        <input type="text" 
                               class="form-control" 
                               id="item_verificacao" 
                               name="item_verificacao" 
                               required
                               placeholder="Descreva o item a ser verificado">
                    </div>
                    
                    <div class="mb-3">
                        <label for="criterio_conformidade" class="form-label">Critério de Conformidade *</label>
                        <textarea class="form-control" 
                                  id="criterio_conformidade" 
                                  name="criterio_conformidade" 
                                  rows="3" 
                                  required
                                  placeholder="Descreva os critérios para conformidade"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="observacao" class="form-label">Observação</label>
                        <textarea class="form-control" 
                                  id="observacao" 
                                  name="observacao" 
                                  rows="3"
                                  placeholder="Observações adicionais sobre este item"></textarea>
                    </div>
                    
                    <div class="card bg-light mb-3" id="nc-fields" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title text-danger">
                                <i class="bi bi-exclamation-triangle"></i> Informações da Não Conformidade
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="classificacao_nc" class="form-label">Classificação da NC</label>
                                    <select class="form-select" id="classificacao_nc" name="classificacao_nc">
                                        <option value="">Selecione...</option>
                                        <option value="L">Leve (L)</option>
                                        <option value="M">Moderada (M)</option>
                                        <option value="G">Grave (G)</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="responsavel_id" class="form-label">Responsável pela Correção</label>
                                    <select class="form-select" id="responsavel_id" name="responsavel_id">
                                        <option value="">Selecione um usuário...</option>
                                        {% for usuario in usuarios %}
                                        <option value="{{ usuario.id }}">{{ usuario.nome }} - {{ usuario.funcao }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="acao_corretiva" class="form-label">Ação Corretiva</label>
                                <textarea class="form-control" 
                                          id="acao_corretiva" 
                                          name="acao_corretiva" 
                                          rows="3"
                                          placeholder="Descreva a ação corretiva necessária"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="prazo_resolucao_dias" class="form-label">Prazo de Resolução (dias)</label>
                                <input type="number" 
                                       class="form-control" 
                                       id="prazo_resolucao_dias" 
                                       name="prazo_resolucao_dias"
                                       min="1"
                                       placeholder="Número de dias para resolução">
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Adicionar Item
                        </button>
                        <a href="{{ url_for('checklist.ver', checklist_id=checklist.id) }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('resultado').addEventListener('change', function() {
        const ncFields = document.getElementById('nc-fields');
        if (this.value === 'Não Conforme') {
            ncFields.style.display = 'block';
        } else {
            ncFields.style.display = 'none';
        }
    });
</script>
{% endblock %}
