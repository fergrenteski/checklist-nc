{% extends "base.html" %}

{% block title %}Editar Item - Sistema NC{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header bg-warning">
                <h3 class="mb-0">
                    <i class="bi bi-pencil"></i> Editar Item
                </h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('checklist.editar_item', item_id=item.id) }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="secao" class="form-label">Seção *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="secao" 
                                   name="secao" 
                                   value="{{ item.secao }}"
                                   required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="resultado" class="form-label">Resultado *</label>
                            <select class="form-select" id="resultado" name="resultado" required>
                                <option value="Conforme" {% if item.resultado == 'Conforme' %}selected{% endif %}>Conforme</option>
                                <option value="Não Conforme" {% if item.resultado == 'Não Conforme' %}selected{% endif %}>Não Conforme</option>
                                <option value="N/A" {% if item.resultado == 'N/A' %}selected{% endif %}>N/A (Não Aplicável)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="item_verificacao" class="form-label">Item de Verificação *</label>
                        <input type="text" 
                               class="form-control" 
                               id="item_verificacao" 
                               name="item_verificacao" 
                               value="{{ item.item_verificacao }}"
                               required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="criterio_conformidade" class="form-label">Critério de Conformidade *</label>
                        <textarea class="form-control" 
                                  id="criterio_conformidade" 
                                  name="criterio_conformidade" 
                                  rows="3" 
                                  required>{{ item.criterio_conformidade }}</textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="observacao" class="form-label">Observação</label>
                        <textarea class="form-control" 
                                  id="observacao" 
                                  name="observacao" 
                                  rows="3">{{ item.observacao or '' }}</textarea>
                    </div>
                    
                    <div class="card bg-light mb-3" id="nc-fields" {% if item.resultado != 'Não Conforme' %}style="display: none;"{% endif %}>
                        <div class="card-body">
                            <h5 class="card-title text-danger">
                                <i class="bi bi-exclamation-triangle"></i> Informações da Não Conformidade
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="classificacao_nc" class="form-label">Classificação da NC</label>
                                    <select class="form-select" id="classificacao_nc" name="classificacao_nc">
                                        <option value="">Selecione...</option>
                                        <option value="L" {% if item.classificacao_nc == 'L' %}selected{% endif %}>Leve (L)</option>
                                        <option value="M" {% if item.classificacao_nc == 'M' %}selected{% endif %}>Moderada (M)</option>
                                        <option value="G" {% if item.classificacao_nc == 'G' %}selected{% endif %}>Grave (G)</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="responsavel_id" class="form-label">Responsável pela Correção</label>
                                    <select class="form-select" id="responsavel_id" name="responsavel_id">
                                        <option value="">Selecione um usuário...</option>
                                        {% for usuario in usuarios %}
                                        <option value="{{ usuario.id }}" {% if item.responsavel_id == usuario.id %}selected{% endif %}>
                                            {{ usuario.nome }} - {{ usuario.funcao }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="acao_corretiva" class="form-label">Ação Corretiva</label>
                                <textarea class="form-control" 
                                          id="acao_corretiva" 
                                          name="acao_corretiva" 
                                          rows="3">{{ item.acao_corretiva or '' }}</textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="prazo_resolucao_dias" class="form-label">Prazo de Resolução (dias)</label>
                                <input type="number" 
                                       class="form-control" 
                                       id="prazo_resolucao_dias" 
                                       name="prazo_resolucao_dias"
                                       value="{{ item.prazo_resolucao_dias or '' }}"
                                       min="1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-check-circle"></i> Salvar Alterações
                        </button>
                        <a href="{{ url_for('checklist.ver', checklist_id=item.checklist_id) }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('resultado').addEventListener('change', function() {
        const ncFields = document.getElementById('nc-fields');
        if (this.value === 'Não Conforme') {
            ncFields.style.display = 'block';
        } else {
            ncFields.style.display = 'none';
        }
    });
</script>
{% endblock %}
